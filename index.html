<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<html lang="en" class="no-js">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Home</title>
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="author" content="" />

	<script src="js/modernizr.custom.js"></script>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/jquery.fancybox.css" rel="stylesheet">
	<link href="css/flickity.css" rel="stylesheet">
	<link href="css/animate.css" rel="stylesheet">
	<link rel="stylesheet" href="css/font-awesome.min.css">

	<link href="css/styles.css" rel="stylesheet">
	<link href="css/queries.css" rel="stylesheet">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="js/html5shiv.js"></script>
		<script src="js/respond.min.js"></script>
		<![endif]-->
</head>

<body>
	<header id="main">
		<section class="hero">
			<div class="container">
				<div class="row nav-wrapper">
					<div class="col-md-6 col-sm-6 col-xs-6 text-left" style="font-size: 20px">
					</div>

				</div>
				<div class="row hero-content">
					<div class="col-md-12 text-center">
						<h1 class="animated fadeInDown">TY供应链查询系统
							<br/>基于星云链</h1>
						<a href="#features" class="read-btn animated fadeInUp">查询</a>

						<h1 id="noExtension" style="display: none">请安装
							<a target="_blank" href="https://github.com/ChengOrangeJu/WebExtensionWallet">WebExtensionWallet</a> 再使用</h1>
					</div>
				</div>
			</div>
		</section>
	</header>
	<section class="services-list page-section" id="features">
		<div class="container">
			<div class="row">
				<div class="title-section text-center">
					<h2>功能介绍</h2>
					<div class="divider">
						<i class="fa fa-star-o fa-lg"></i>
					</div>
				</div>
				<div class="disc-section text-center">
					<p>基于新一代区块链公链星云链，致力于构建公开透明可溯源的商品供应链查询系统</p>
				</div>
				<div class="col-md-12">

					<div class="col-md-4 feature-1 wp2">
						<div class="feature-icon">
							<i class="fa fa-desktop"></i>
						</div>
						<div class="feature-content">
							<h1>公开透明</h1>
							<p>任何人可通过该网站查询商品供应链信息，保证每个环节公开透明</p>
						</div>
					</div>
					<div class="col-md-4 feature-2 wp2 delay-05s">
						<div class="feature-icon">
							<i class="fa fa-globe"></i>
						</div>
						<div class="feature-content">
							<h1>可溯源</h1>
							<p>从源头（供应商）到终端消费者，保障商品质量，防伪</p>
						</div>
					</div>
					<div class="col-md-4 feature-3 wp2 delay-1s">
						<div class="feature-icon">
							<i class="fa fa-star"></i>
						</div>
						<div class="feature-content">
							<h1>不可篡改</h1>
							<p>基于新一代区块链公链星云链，一旦记录，永久不可篡改</p>
						</div>
					</div>

				</div>
			</div>
		</div>
	</section>
	<section id="about" class="aboutUs page-section">
		<div class="aboutUs-wrap">
			<div class="title-section text-center wp2">
				<h2>供应链信息查询</h2>
				<br>
			</div>
			<div class="container">
				<div class="row">
					<input type="text" name="name" id="search_value" required="required" class="form wp2" placeholder="请填写商品编号(例如:GT123456789)">
					<div class="relative fullwidth col-xs-12">
						<!-- Send Button -->
						<button id="search" name="submit" class="form-btn semibold wp2">查询</button>
					</div>
				</div>
				<div class="row" id="app">
					<table id="tableList" class="table table-bordered" style="display:none;color: #fff;margin-top: 30px">
						<thead>
							<tr>
								<th>供应环节</th>
								<th>地址</th>
								<th>服务商编号</th>
								<th>日期</th>
							</tr>
						</thead>
						<tbody>
							<tr v-for="l in list">
								<td v-html="l.link"></td>
								<td v-html="l.value"></td>
								<td v-html="l.serverNo"></td>
								<td v-html="l.date"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</section>
	<section class="testimonial page-section">
			<div class="container">
				<div class="row">  
					<div class="col-md-12">
						<div class="features-slider">
								<ul class="slides" id="featuresSlider">
									<li>
										<h2>服务商认证查询</h2>
										<p>查询服务商信息</p>
										<p>开发中，尽请期待</p>
									</li>
									<li>
										<h2>商品防伪</h2>
										<p>指定服务商</p>
										<p>开发中，尽请期待</p>
									</li>
								</ul>
						</div>
					</div>
				</div>
			</div>
		</section>
	<section id="contact" class="container page-section">
		<!-- Contact Inner -->
		<div class="inner contact wp2 delay-05s">
			<div class="title-section text-center">
				<h2>供应链信息录入</h2>
				<div class="divider">
					<i class="fa fa-star-o fa-lg"></i>
				</div>
			</div>
			<!-- Form Area -->
			<div class="contact-form">
				<!-- Form -->
				<!-- Left Inputs -->
				<div class="col-xs-6 animated fadeInLeft visible" data-animation="fadeInLeft" data-animation-delay="300">
					<input type="text" id="projectId" class="form" placeholder="商品编号">
					<input type="text" id="addr" class="form" placeholder="地址">
				</div>
				<!-- End Left Inputs -->
				<!-- Right Inputs -->
				<div class="col-xs-6 animated fadeInRight visible" data-animation="fadeInRight" data-animation-delay="400">
					<input type="text" id="link" class="form" placeholder="供应环节">
				</div>
				<!-- End Right Inputs -->
				<!-- Bottom Submit -->
				<div class="relative fullwidth col-xs-12">
					<!-- Send Button -->
					<button id="push" name="submit" class="form-btn semibold">提交</button>
				</div>
				<!-- End Bottom Submit -->
				<!-- Clear -->
				<div class="clear"></div>
			</div>
			<!-- End Contact Form Area -->
		</div>
		<!-- End Inner -->
	</section>

	<footer id="footer" class="footer">
		<section id="site-socials" class="no-padding white-bg">
			<div class="site-socials inner no-padding">

				<!-- Adress, Mail -->
				<div class="address socials animated fadeInRight visible" data-animation="fadeInRight" data-animation-delay="500">
					<!-- Phone Number, Mail -->
					<p>Copyright &copy; 2018.基于
						<a href="https://nebulas.io/" target="_blank">NAS</a>的商品供应链查询系统
						<a href="https://incentive.nebulas.io/cn/signup.html?invite=32KAi" target="_blank">点我发布DAPP获取100NAS</a>
					</p>
					<p>联系方式：779205344@qq.com</p>

				</div>
				<!-- End Adress, Mail -->
			</div>
			<!-- End Inner -->
		</section>
	</footer>
	<script src=js/nebPay.js></script>
	<script src="js/toucheffects.js"></script>
	<script src="js/jquery.min.js"></script>
	<script src="js/flickity.pkgd.min.js"></script>
	<script src="js/jquery.fancybox.pack.js"></script>
	<script src="js/waypoints.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/scripts.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>
	<script src="js/layer/layer.js" type="text/javascript" charset="utf-8"></script>
	<script>
		$(function () {
			var NebPay = require("nebpay");
			var nebPay = new NebPay();

			var dappAddress = "n21toP4EgScbkTnArg6fzsnZ91JpLJZjvP4";
			//检查扩展是否已安装
			//如果安装了扩展，var“webExtensionWallet”将被注入到web页面中1
			setTimeout(function () {
				if (typeof (webExtensionWallet) === "undefined") {
					//alert ("扩展钱包未安装，请先安装.")
					$("#noExtension").show();
				}
			}, 500);


			$("#search").click(function () {
				var search_value = $("#search_value").val();
				if (search_value == '') {
					search_value='GT123456789'
				}
				var to = dappAddress;
				var value = "0";
				var callFunction = "get";
				var callArgs = [];
				callArgs.push(search_value);
				nebPay.simulateCall(to, value, callFunction, JSON.stringify(callArgs), {
					listener: cbSearch
				});
			})

			function cbSearch(resp) {
				var result = resp.result
				if (result === 'null') {
					layer.msg('没有查到商品供应链信息');
				} else {
					$('#tableList').show();
					var resultObj = JSON.parse(result);
					var len = resultObj.value.split('|-').length;
					var obj = [];
					for (var i = 0; i < len; i++) {
						var temp = {
							link: resultObj.link.split('|-')[i],
							value: resultObj.value.split('|-')[i],
							serverNo: resultObj.author.split('|-')[i],
							date: resultObj.date.split('|-')[i],
						}
						obj.push(temp);
					}
					Vue.set(app, 'list', obj)
				}

			}

			$("#push").click(function () {
				var projectId = $('#projectId').val();
				var addr = $('#addr').val();
				var link = $('#link').val();
				if (projectId == '') {
					layer.msg('商品编号不能为空');
					return;
				} else if (addr == '') {
					layer.msg('地址不能为空');
					return;
				} else if (link == '') {
					layer.msg('供应环节不能为空');
					return;
				}
				var to = dappAddress;
				var value = "0";
				var callFunction = "save"
				var callArgs = [];
				callArgs.push(projectId);
				callArgs.push(addr);
				callArgs.push(link);
				callArgs.push(new Date().format("yyyy-MM-dd hh:mm:ss"))
				nebPay.call(to, value, callFunction, JSON.stringify(callArgs), {
					listener: cbPush
				});
			});

			function cbPush(resp) {
				console.log("response of push: " + resp)
			}

			var app = new Vue({
				el: '#app',
				data: {
					list: []
				}
			});


			Date.prototype.format = function (format) {
				var args = {
					"M+": this.getMonth() + 1,
					"d+": this.getDate(),
					"h+": this.getHours(),
					"m+": this.getMinutes(),
					"s+": this.getSeconds(),
					"q+": Math.floor((this.getMonth() + 3) / 3),  //quarter
					"S": this.getMilliseconds()
				};
				if (/(y+)/.test(format))
					format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
				for (var i in args) {
					var n = args[i];
					if (new RegExp("(" + i + ")").test(format))
						format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? n : ("00" + n).substr(("" + n).length));
				}
				return format;
			};
		})
	</script>
</body>

</html>
